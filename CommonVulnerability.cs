using System;
using LogAnalysisTool.ApacheLogs.AnomalyBasedDetectionTests;

namespace LogAnalysisTool
{
    /// <summary>
    /// CommonVulnerability() - Logic to determine whether a possible vulnerability was detected by both detection
    /// mechanisms
    /// </summary>
    internal class CommonVulnerability : IDetectionItem
    {
        internal CommonVulnerability(IAnomalyDetectionItem anomalyDetection, MaliciousLogEntryInfo behaviourDetection)
        {
            BehaviourDetection = behaviourDetection;
            AnomalyDetection = anomalyDetection;

            // Guard against creating a common vulnerability with differing line numbers
            if (anomalyDetection.LineNumber != behaviourDetection.LineNumber)
            {
                throw new Exception($"The line numbers for the Anomaly and Behaviour based detections do not match");
                ;
            }

            LineNumber = anomalyDetection.LineNumber;
            Request = anomalyDetection.Request;
        }

        public MaliciousLogEntryInfo BehaviourDetection { get; set; }

        public IAnomalyDetectionItem AnomalyDetection { get; set; }

        public int LineNumber { get; private set; }

        public string Request { get; private set; }
    }
}
